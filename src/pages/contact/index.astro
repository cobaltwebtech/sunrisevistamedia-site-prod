---
import BaseLayout from "@/layouts/BaseLayout.astro";
import ContentSection from "@/components/sections/ContentSection.astro";
import ContactForm from "@/components/sections/ContactForm.astro";
import Button from "@/components/Button.astro";
import { Icon } from "astro-icon/components";
import { SITE } from "@/constants";

const cfTurnstile = {
  src: "https://challenges.cloudflare.com/turnstile/v0/api.js",
  type: "text/javascript"
};

const pageTitle: string = `Contact Us | ${SITE.title}`;
---

<BaseLayout
  title={pageTitle}
  structuredData={{
    "@context": "https://schema.org",
    "@type": "WebSite",
    "url": "https://www.sunrisevistamedia.com/",
    "name": "Sunrise Vista Media",
    "description": "Sunrise Vista Media is a full-service production company that specializes in creating high-quality video content.",
    "inLanguage": "en-US"
  }}
  externalScript={cfTurnstile}
>
    <div class="space-y-24 px-8 py-32">
        <ContentSection title="Contact Us">
            <Icon slot="eyebrow" name="video" class="size-24" />
            <Fragment slot="lead">
                Contact info here      
            </Fragment>
        </ContentSection>
        <ContactForm
     </div>
</BaseLayout>
<!-- Handle form submission data and messages. See ContactForm.astro for elements -->
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
      const form = document.getElementById('contact-form') as HTMLFormElement;
      const errorMessageContainer = document.getElementById('error-message') as HTMLDivElement;
  
      if (form) {
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const formData = new FormData(form);
          
          try {
            const response = await fetch('/api/sendContactEmail', {
              method: 'POST',
              body: formData
            });
  
            if (response.redirected) {
              // If the server responded with a redirect, follow it
              window.location.href = response.url;
            } else if (response.ok) {
              const result = await response.json();
              if (result.success) {
                // Redirect to the confirmation page if the server didn't already do so
                window.location.href = '/contact/submission-received/';
              } else {
                throw new Error(result.error || 'An error occurred');
              }
            } else {
              throw new Error('Server responded with an error');
            }
          } catch (error) {
            console.error('Error:', error);
            if (errorMessageContainer) {
              errorMessageContainer.textContent = error instanceof Error ? error.message : 'An unexpected error occurred. Please try again later.';
              errorMessageContainer.style.display = 'block';
            }
          }
        });
      }
    });
</script>
  